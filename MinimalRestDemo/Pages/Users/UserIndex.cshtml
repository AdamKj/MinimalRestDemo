@page
@model MinimalRestDemo.Pages.Users.UserIndexModel
@{
    ViewData["Title"] = "Users page";
}

<form action="/users" method="post">
    <input type="text" id="user-name" placeholder="Namn">
    <br/>
    <input type="text" id="user-email" placeholder="Email">
    <br/>
</form>
<button class="btn btn-secondary" id="add-user">Add user</button>

<br/>

<button class="btn btn-primary" id="get-users">Get Users</button>

<ul class="mt-3" id="user-list"></ul>

@section Scripts {
    <script>

        const userList = document.getElementById("user-list");
        const getAllUsers = document.getElementById("get-users");
        const addUser = document.getElementById("add-user");

        addUser.addEventListener('click',
            function(event) {
                event.preventDefault();
                const userName = document.getElementById("user-name").value;
                const userEmail = document.getElementById("user-email").value;
                const userInfo = { name: userName, email: userEmail};
                postUser("/users", userInfo);
            });


        getAllUsers.addEventListener("click",
            () => {
                showUsers();
            });

        const showUsers = () => {
            userList.innerHTML = "";
            fetch("/users")
                .then(response => response.json())
                .then(data => {
                    for (let i = 0; i < data.length; i++) {
                        const li = document.createElement("li");
                        li.innerText = `Namn: ${data[i].name}, Email: ${data[i].email}`;
                        userList.appendChild(li);
                    }
                });
        }
        const postUser = (url = "", data = {} ) => {
            fetch(url,
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(data)
                    })
                .then(response => console.log(response));
        }
    </script>
}